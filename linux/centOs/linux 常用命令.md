	[^author:姚留洋]

[^created_at:2021/10/24]

## 输出重定向

> 一般命令的输出都会显示在终端中,有时候需要将一些命令的执行结果保存到文件中
>
> 进行后寻的分析/统计，则这时候需要使用到的输出重定向技术。

**命令**

```shell
> # 覆盖输输出（一个大于号），会覆盖原有的文件内容
>> # 追加输出（两个个大于号），不会不该原始文件内容，会在原始内容末尾继续添加
# 语法 正常执行的指令 >/>> 文件的路径
# 注意 ：文件可以不存在,不存在则新建
# 案例：使用覆盖重定向,保存ls -la 的执行结果,保存到当前目录下的ls.txt
```

**案例**

```shell
# 覆盖输出 >
yaoliuyang@benben:~$ touch demo.txt 
yaoliuyang@benben:~$ ls
公共的  模板  视频  图片  文档  下载  音乐  桌面  demo.txt  sensors  snap
yaoliuyang@benben:~$ echo 测试覆盖文字1 > demo.txt 
yaoliuyang@benben:~$ cat demo.txt 
测试覆盖文字1
yaoliuyang@benben:~$ echo 测试覆盖文字2 > demo.txt 
yaoliuyang@benben:~$ cat demo.txt 
测试覆盖文字2
# 追加输出 >>
yaoliuyang@benben:~$ echo 追加文字 >> demo.txt 
yaoliuyang@benben:~$ cat demo.txt 
测试覆盖文字2
追加文字

# 输出变量到文件    https://www.cnblogs.com/moonandstar08/p/7282203.html
# 输出当前的时间到text文件中
echo $(date "+%Y-%m-%d %X") >> text.txt
```

## 管道命令 

> 管道符 `|`,就是俗话所说的竖线
>
> **作用**
>
> 管道一般可以用来**过滤**,**特殊**,**扩展处理**
>
> **语法**
>
> 管道不可以单独使用必须配合一些命令使用,辅助作用

**案例**

**过滤例子**

```shell
# 筛选/目录下名称为o的目名称
yaoliuyang@yaoliuyang-PC:/$ ls | grep o
boot
home
lost+found
opt
proc
recovery
root
```

## 操作服务器的主机名

> `hostname`   读取设置主机名

```shell
# 查看当前的主机名 含义:表示输出完整的主机名 
$ hostname 
yaoliuyang-PC
# 含义:表示输出当前主机名中的FQDN(全限定域名)
$ hostname -f
yaoliuyang-PC
```

## 处理文件命令:sed

[sed命令详解](https://www.runoob.com/linux/linux-comm-sed.html)

### 替换文件中的字符

> 假如现在有一个文件a.txt，如下图所示我想将 www.baidu.com 修改为 www.aliyun.com

```shell
[root@VM-16-5-centos ~]# cat a.txt 
"www.baidu.com@1"
"www.baidu.com@2"
"www.baidu.com@3"
"www.baidu.com@4"
"www.baidu.com@5"
# 命令如下 -i insert 可以理解为插入的意思   s select 可以理解为选择的意思  g global 全局的意思
[root@VM-16-5-centos ~]# sed -i  's/www.baidu.com/www.aliyun.com/g' a.txt 
[root@VM-16-5-centos ~]# cat a.txt 
"www.aliyun.com@1"
"www.aliyun.com@2"
"www.aliyun.com@3"
"www.aliyun.com@4"
"www.aliyun.com@5"

```



## [显示当前进程信息](https://www.runoob.com/linux/linux-comm-ps.html)

> 指令：**ps**
>
> 作用：主要查看服务器的进程信息
>
> 选项含义
>
> ​    -e:  等价于**-A** 表示列出全部的进程
>
> ​    -f:  显示全部的列

**示例**

```shell
ps -ef | grep 进程关键字

# ps -ef  

UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 11:43 ?        00:00:05 /sbin/init splash
root         2     0  0 11:43 ?        00:00:00 [kthreadd]

# UID 该进程执行的用户id
# PID 进程id
# PPID 该进程的父级进程id,如果一个程序的父级进程找不到,该程序的进程称之为僵尸进程(没什么用了)
# C  Cpu的占用率,其形式是百分数
# STIME  Start_time,该进程的启动事件
# TTY 终端设备,发起该进程的设备识别符号,如果显示“?”意思是不是由终端发起的进程,
# TIME 进程的执行时间
# CMD  进程对应的名称或者对应的路径
```

## vim命令

**资料**

| 名称         | 地址                                                |
| ------------ | --------------------------------------------------- |
| 菜鸟教程-vim | [link](https://www.runoob.com/linux/linux-vim.html) |
| vim-中文官网 | [link](http://vimcdoc.sourceforge.net/)             |

### **常用命令示例**

```shell
# 光标操作
gg  #跳转到首行(小写)
G   # 跳转到末行(shift +g  或者 CapsLock +g)
shift + ^ # shift + 最上排的数字6 跳转到一行的开始(正则表达式开始)
shift + $ # shift + 最上排的数字4 跳转到一行的末尾(正则表达式结束)
ctrl+b(before)  or pageup# 向上 翻屏
ctrl+f()  or pagedown# 向下 翻屏

# 复制操作
# 1 复制光标所在行
yy           # 按键复制
p            # 按键黏贴所复制的行
# 2 以光标所在行为准,向下复制指定的行数
数字+yy  # 数字+yy 例  3yy   以光标所在行向下复制三行(包含当前光标行再向下两行) 

# 3.可视化复制(用的比较少)
按键：ctrl+v,然后按下↑↓←→方向键选中需要复制的区块,按下yy键进行复制,最后按下p键黏贴

# 剪切/删除
# 1. 剪切删除光标所在行
dd  # 删除之后下一行上移
dd 之后 再 p # 先剪贴再黏贴==剪切 (如果剪切了不粘帖就是删除效果)
n + dd  # n 为数字。剪切光标所在的向下 n 行，例如 20dd 则是剪切 20 行(常用),用p可以粘贴。
# 2. 剪切/删除光标所在行,但是删除之后下一行不上移
D # 大写的D  shift d


# 撤销/恢复(win ctrl+z 撤销 ctrl+y恢复)
# 1.撤销命令
:u  # 命令行输入字母u  Enter键确定(重复撤销 重复操作):undo 撤销 
u # 命令模式 直接u  重复撤销重复操作
# 2. 恢复
ctrl + r # 恢复(取消)之前的撤销:restore 恢复

#********************************************************************#
# 格式化文件(参考 https://wenku.baidu.com/view/206645f687254b35eefdc8d376eeaeaad1f316de.html)
<<!
在vim的命令模式下，输⼊=，vim进⼊格式化状态，在编辑屏幕的右下⾓可以看到有=，表⽰已经进⼊了格式化模式，此时输⼊的任何命令
都是格式化操作，⾮法命令则不解释。
!
# 1. 常见操作：
格式化光标⾏开始的3⾏
在格式化模式下输⼊3=
=3=
格式化当前⾏到第25⾏的代码：
在格式化模式下输⼊25G
=25G
格式化{}内的代码段：
将光标移到{}的上（{或者}均可），在格式化模式下输⼊%
=%
格式化#if #else #endif之间的代码：
将光标移到#if #else上，在格式化模式下输⼊%：
=%
将会格式化其中⼀个选择项的代码。
如果将光标放在#endif上，进⼊格式化模式，再输⼊%，则会格式化整个条件匹配的代码。
=%
格式化整篇⽂档全部：
在格式化模式下输⼊G
=G
或者直接在命令模式下输⼊
gg=G
#********************************************************************#

# 光标的快速移动 
n+G          # 快速将光标移动到指定的位置(数字+大写的G) G可以理解为：Go to Line:Column  跳转到第几行
n+↑/↓        # 以当前光标为准向上/向下/向下移动n行(数字+上键/下键)
n+←/→        # 以当前光标为准像左/右移动移动n字符(数字+左/右)
: n          # 末行模式下(: 冒号输入命令的模式下) 冒号输入字母上排的数字  Enter键确定

# 模式间的切换
# 1. 末行模式
进入方式:由命令模式进入,按下":"即可进入末行方式
:wq  #冒号代表的是末行模式因为在最后一行(退出 1.按一下esc(会等待一会) 2.按两下esc 立即退出 3. 删除末行下的命令包括冒号)
# 2.保存操作(write)
输入: ":w"  保存文件
输入: ":w 路径" 另存为
# 3.退出(quit)
输入: ":q"  退出文件
输入: ":wq"  保存并退出
输入: "q!" 强制退出不保存
# 4.调用外部命令
:!ls # 例如我们在文件中想调用外部命令(vim里面调用外部命令) !+命令
# 6.搜索(末行模式下输入反斜杠/+搜索的关键字 Enter键盘第一次确认,再次向下搜索使用按键n)
:/关键词  #例如 
:nohl  #[no highlight] 取消高亮,上一步查询之后搜索的关键词依然会保持高亮状态,如果觉得不舒服可以取消

# 7.替换指令 
:s/搜索的关键词/新的内容 # [strreplace] 如果在光标所在行进入命令模式下替换命令,则会匹配光标所在行的关键词进行替换 (替换光标所在行第一处符合条件的内容)
:s/搜索的关键词/新的内容/g # 替换光标所在行的全部符合条件的内容
:%s/搜索的关键词/新的内容  # 替换全局所有行第一处符合条件的内容
:%s/搜索的关键词/新的内容/g  # 替换全局所有行所有符合条件的内容  %表示整个文件,g表示全局(global)

# 8.显示行号
:set nu  # 显示行号
:set number # 显示行号全拼
:set nonu # 取消显示行号

# 9. 退出方式
回顾:之前vim中退出编辑的文件可以使用":q"或者":wq"
除了上面的这个语法之外,vim还支持另外一个保存退出方式":x"
:x    # 在文件没有修改的情况下,表示直接退出,在文件修改的情况下表示保存并退出,如果文件没有被修改(这时候也习惯退出用wq),则文件的修改时间会被更新,但是如果文件没有被修改,使用x进行退出的话,则文件修改时间不会被更新的,主要是会混淆用户对文件的修改时间的认定,

# 10,文件加密&解密
:X  # 加密 输入两次密码(wq确认)
:X  # 解密 输入两次空(按两下回车键确认)
```

### **使用vim打开多个文件,在末行模式下进行切换文件 **

```php
# 打开多个文件命令
vim 文件路径1 文件路径2 文件路径3 作用:同时打开多个文件 # 会默认打开文件1  例 vim demo01.txt demo.txt
# 查看当前已经打开的文件名称: ":files"
:files 
# 例    
:files
  1 %a   "demo01.txt"                   line 17        
  2      "demo.txt"                     line 0
# %a 的位置有2中显示可能 
 %a : a=active,表示当前正在打开的文件
 #  ： 井号表示上一个打开的文件   

# 切换文件
/**
 * 1.如果需要指定切换文件的名称,则可以输入: ":open 需要打开的文件名称"
 */
 :open demo.txt
 // 打开之后再次查看可以看出我们上一个文件是 demo01.txt  当前活动文件是 demo.txt   
 :files
  1 #    "demo01.txt"                   line 17
  2 %a   "demo.txt"                     line 23
 
/**
 * 2.可以通过其它命令来切换上一个/下一个文件
 */   
:bn      # 切换到下一个文件  back next
:bp      # 切换到上一个文件  back prev(prev表示 Previous 以前的)  
```

### **编辑模式**

```php
i # 在光标所在字符前开始插入:insert(这个必须记住)
a # 在光标所在字符后开始插入:after (这个必须记住)
o # 在光标所在行的下面另起一行插入
I # 在光标所在行的行首开始插入 如果行首有空格则在空格之后插入
A # 在光标所在行的行尾开始插入
O # 在光标所在上的上面另起一行开始插入
S # 删除光标所在行并开始插入    
```

**实用功能**

```php
# 1.代码着色
# 案例
vim hello.c
# 添加编辑---开始   
#include <stdio.h>
    void main(){
    printf(hello world!)
 }
# 添加编辑---结束

# 关闭显示着色  syntax:语法  
:syntax on    # 显示
:syntax off    # 关闭显示
#--------------------------------------------------------------------------------------------------------------------     
# 2.vim中计算器的使用
当在编辑文件的时候突然需要使用计算器去计算一些公式,则此时需要用计算器,但是需要退出,vim自身集成了一个简易的计算器
# a.进入编辑模式 insert
# b.按下按键"ctrl+r",然后输入"=",此时光标会变到最后一行
# c.输入需要计算的内容"=2+3"回车键确认    
#-------------------------------------------------------------------------------------------------------------------- 
    
```



### **vim配置文件**

**说明**

> Vim 配置文件分为系统配置文件和用户配置文件：
>
> - 系统配置文件位于 Vim 的安装目录（默认路径为 /etc/.vimrc）；
> - 用户配置文件位于主目录 ~/.vimrc，即通过执行 `vim ~/.vimrc` 命令即可对此配置文件进行合理修改。通常情况下，Vim 用户配置文件需要自己手动创建。
>
> **简洁说明**
>
> 每个人使用编辑器例如**ide**都会有不同的设置习惯，编辑vim配置可以让我们构建自己喜欢的风格的配置**例如vim** 打开文件自动显示
>
> 行号

**资料**

| 名称       | 地址                                                         |
| ---------- | ------------------------------------------------------------ |
| 第三方博客 | [link](http://c.biancheng.net/view/3024.html)  [link](https://www.bookstack.cn/read/use_vim_as_ide/0.1.md) |

```php
# 说明
vim 是一款编辑器,编辑器也是有配置文件的.
vim配置有三种情况
   a.在文件打开的时候在末行模式下输入的配置(临时的) 例如：set nu 显示行号
   b.个人配置文件(~/.vimrc) 自己的家目录(此文件可能不会存在,如果没有可以自行新建)
   c.全局配置文件(vim自带:/etc/vimrc)
    
# 个人配置(~/.vimrc)
//① 新建好个人配置文件进入编辑    
[root@VM-16-5-centos ~]# ls .vimrc     // 查询是否存在
ls: cannot access .vimrc: No such file or directory  
[root@VM-16-5-centos ~]# touch .vimrc     //不存在新建
//②在配置文件中进行配置(当前用户永久)
 set nu        //比如显示行号
 syntax off     //vim编辑器不显示着色(不推荐使用)
 ......
# 全局配置文件(vim自带:/etc/vimrc)
    
```

**问题**

```php
# 1. 如果某个配置项,在个人配置文件与全局配置文件产生冲突的时候因该以谁为准?
//①实现开始(配置个人配置显示行号,全局配置不显示行号)
个人配置(~/.vimrc)下添加               set nu  
全局配置(vim自带:/etc/vimrc)下添加      set nonu    
//结果可以看出配置项会以个人配置为最高优先级   
    
//②实现继续二(配置个人配置不显示行号,全局配置显示行号)
个人配置(~/.vimrc)下添加               set nonu   
全局配置(vim自带:/etc/vimrc)下添加      set nu   
//结果可以看出配置项会以个人配置为最高优先级 
结论:如果针对于同一个配置项,个人配置文件中存在则以个人配置为准,如果个人配置文件中不存在这一项,则以全局配置文件为准
#----------------------------------------------------------------------------------

#2. 异常退出(非法退出:例如在编辑模式中强制关闭shell窗口,在编辑文件之后并没有正常的去wq（保存退出）而是遇到突然关闭终端或者断电的情况,则会显示下面的效果，这种情况称之为异常退出)
//再次重新编辑此文件就会显示以下(交换文件".demo.txt.swp"已经存在!)
.....    
Swap file ".demo.txt.swp" already exists!
[O]pen Read-Only, (E)dit anyway, (R)ecover, (D)elete it, (Q)uit, (A)bort:  # 只读，编辑，覆盖，删除，uit, bot:

// 解决办法(将交换文件删除即可(在编程过程中产生的临时文件))
 删除 .demo.txt.swp 交换文件
 ls .demo.txt.swp   //查询是否存在(可忽略)
 rm -rf .demo.txt.swp   //删除交换    
```

## [别名机制](https://www.runoob.com/linux/linux-comm-alias.html)(创建自己的linux命令)

> **作用:**相当于创建一些属于自己的自定义命令
>
> **例如:** 在`windows`下有`cls`命令,在Linux下可能因为没有这个命令而不习惯清屏,现在可以通过别名机制来解决
>
> 这个问题,可以自己创造出`cls`命令
>
> ###  别名机制依靠一个别名<font color='red'>映射</font>文件(当前用户家目录下):  ~/.bashrc
>
> > 像是一个连线题左右映射,左边可以关联右边,右边可以关联左边
>
> ```php
> 绿绿的        花朵
> 青青的        草地
> 蓝蓝的        天空    
> ```

```php
# 1. 编辑 .bashrc 手动添加命令(编辑之后wq保存,重新登录当前用户账户生效:退出shell重新登录)
vim ~/.bashrc
# 添加开始--------------------

# .bashrc
# User specific aliases and functions

alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'
# 手动添加映射内容 cls命令
alias cls='clear'


# Source global definitions
if [ -f /etc/bashrc ]; then
        . /etc/bashrc
fi  
    
# 添加结束--------------------    
    
#--------------------------------------------end--------------------------------------------------------------     
```

[**使用alias命令添加操作别名**](https://www.coonote.com/linux/linux-cmd-alias.html)

 ```shell
 # 语法
 alias(选项)(参数)
 # 选项
 -p：打印已经设置的命令别名。
 # 设置别名
 alias 新的命令='原命令 -选项/参数' # 例子 alias cls='clear'
 # 删除别名
 unalias 别名名称
 ```



## linux自有服务

> 自有服务,即不需要用户独立去安装软件的服务,而是当系统安装好就可以直接使用的服务(内置)

### 运行模式

> 运行模式也可以称之为<font color='red'>运行级别</font>
>
> 在linux中存在一个进程:**init**(initialize:初始化的意思),进程id是**1**
>
> ```shell
> # 例如(显示表示系统启动之后第一个运行的进程)
> [root@VM-16-5-centos ~]# ps -ef | grep init
> ................
> ```
>
> 该进程存在一个对应的配置文件:**inittab**(<font color='red'>系统运行级别配置文件</font>)  **位置/etc/inittab**
>
> 根据上述的描述,可以得知.Centos6.5中存在7中运行级别/模式
>
> ```shell
> 0-表示关机级别(不要将默认的运行级别设置成0)
> 1-单用户模式
> 2-多用户模式,不带NFS(Network File System) 可以多用户但是没网
> 3-多用户模式,完全的多用户模式(不带桌面的,纯命令行模式)
> 4-没有被使用的模式(被保留模式)
> 5-X11,完整的图形化界面模式
> 6-表示重启级别(不要将默认的运行级别设置成0)
> ```
>
> 与该级别相关的几个命令:
>
> > 这些命令其实都是调用init 进程,将数字(运行级别)传递给进程,进程取读配置文件执行对应的操作.
>
> ```php
> init 0   表示关机
> init 3   表示切换到不带桌面的模式
> init 5   切换到图形界面
> init 6   重启电脑    
> ```
>
> 图形模式设置永久命令模式(将**/etc/inittab**文件中的**initdefault**值设置成3,然后重启操作系统(init 6 命令可以重启))

## 用户于用户组管理(重点)

>    Linux 系统是一个多用户多任务的操作系统,任何一个要使用系统资源的用户,都必须首先向系统管理员申请一个账号,
>
> 然后以这个账号的身份进入系统
>
>    用户账号一方面可以帮助系统管理员对使用系统的用户进行跟踪.并控制他们对系统的资源访问;另一方面也可以帮助用户组织文件.
>
> 并为用户提供安全性保护.
>
>    每个用户账号都拥有一个<font color='red'>唯一的用户名(不能重复)</font>      和各自的密码(密码可以重复)
>
>    用户在登录键入正确的用户名和密码后,就能够进入系统和自己的主目录.
>
> 
>
>    **要想实现用户账号的管理,要完成的工作主要有以下几个方面: **
>
> 1. 用户账号的添加,删除,修改以及用密码的管理
> 2. 用户组的管理

```php
# 注意三个文件:
/etc/passwd      // 存储用户的关键信息
/etc/group       // 存储用户组的关键信息
/etc/shadow      // 存储用户的密码信息 
```

### 用户管理

#### 添加用户

```php
 常用语法: #useradd 选项 用户名
    常用选项
        -g:            表示指定用户的用户组(主组:主要的组),选项的值可以使用户组的id,也可以是组名
        //linux允许用户有多个组但是只能有一个主组
        -G:            表示指定用户的用户组(附加组),选项的值可以使用户组的id,也可以是组名
        -u:  uid:      用户的id(用户的标识符),系统默认会从500之后分配uid,如果不想使用系统分配的,可以通过该选项自定义[类似于腾讯QQ的自选靓号情况] 
        -c: comment:   添加用户注释
案例: 创建用户 yaoliuyang,不带任何选项            
    useradd yaoliuyang  //创建
验证是否成功
    1.验证/etc/passwd的最后一行,查看是否有yaoliuyang的信息  
           cat /etc/passwd  //查看内容是否有创建的用户名
    2.验证是否存在家目录(在Centos下创建好用户之后随之产生一个同名   /home/yaoliuyang):
       ls /home
    3.        
 #----------------------------------------------------------
 注意：在不添加选项的时候,执行 useradd 之后会执行一系列的操作
       a.创建同名的家目录;
       b.创建同名的用户组;
 注意：查看用户的主组,可以查看passwd文件,查看附加组可以查看group文件(某个组后面:附加用户名称)
 #----------------------------------------------------------
 案例:添加选项,创建用户lisi,让李四属于501 主组,附加组500,自选靓号(uid)666
     useradd -g 501 -G 500 -u 666 lisi
```

#### 修改用户

> **usermod(user modify)** 用户编辑

```php
     常用语法: # usermod 选项 用户名
     常用选项
        -c <备注> 　修改用户帐号的备注文字。
        -g <群组> 　修改用户所属的群组。(表示指定用户的用户主组,选项值也可以是用户组的id,也可以是组名)
        -G <群组> 　修改用户所属的附加群组。(uid,用户的id,用户的标识符,系统会默认从500之后按顺序分配uid,如果不想使用系统分配的,可以通过该选项自定义 [类似于腾讯QQ自选靓号情况])
        -l <帐号名称> 　修改用户帐号名称。
        -L 锁定用户密码，使密码无效。
        -d 登入目录> 　修改用户登入时的目录。
        -e <有效期限> 　修改帐号的有效期限。
        -f <缓冲天数> 　修改在密码过期后多少天即关闭该帐号。
        -s <shell> 　修改用户登入后所使用的shell。
        -u <uid> 　修改用户ID。
        -U 解除密码锁定。
```

**案例**

```shell
# 案例一
# 修改用户主组&附加组(cat /etc/group 查看)
usermod -g 500 -G 501 yaoliuyang     # 修改yaoliuyang用户组为500,附加组为501
# ----------------------------------------------------------------------------
# 案例二
# 修改yaoliuyang 用户用户名,修改为 yaokun
usermod -l yaokun(新用户名) yaoliuyang(旧用户名) 
```

####  [设置密码](https://www.runoob.com/linux/linux-comm-passwd.html)

> Linux passwd命令用来更改使用者的密码,linux不允许没有密码的用户登录到系统
>
> 因此前面创建的用户目前都处于锁定状态,需要设置密码之后才能登录计算机

```shell
passwd 用户名 # 设置密码

# 常用选项
-d 删除密码
-f 强迫用户下次登录时必须修改口令
-w 口令要到期提前警告的天数
-k 更新只能发送在过期之后
-l 停止账号使用
-S 显示密码信息
-u 启用已被停止的账户
-x 指定口令最长存活期
-g 修改群组密码
指定口令最短存活期
-i 口令过期后多少天停用账户
```



### 认识**passwd**文件

```php
cat /etc/passwd
........
yaoliuyang:x:1001:1001::/home/yaoliuyang:/bin/bash
........

用户名:密码:用户id:用户组id:注释:家目录:解释器shell
# 用户名:创建新用户名称,后期登录的时候需要输入;
# 密码:此密码未知一般情况下都是"x",表示密码的占位
# 用户ID:用户的识别符;
# 用户组ID:该用户所属的主组ID         可以使用  cat /etc/group 命令查看组
# 注释：解释一下该用户是做什么用的;
# 家目录：用户登录系统之后默认的位置    
# 解释器shell：等待用户进入系统之后,用户输入指令之后,改解释器会手机用户输入的指令,传递给内核处理;(信息传递的桥梁)    
```

























