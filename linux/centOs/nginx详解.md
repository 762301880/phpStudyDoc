# 



## nginx基本概念

```shell
# nginx基本概念
1 nginx 是什么可以做什么事情
2 反向代理
3 负载均衡
4 动静分离
```

> nginx配置文件 /etc/nginx/nginx.conf

```shell

yaoliuyang@yaoliuyang-PC:/etc/nginx$ cat nginx.conf 
# 全局块 从配置文件到events块的内容，主要会设置一些影响nginx服务器整体运行的配置指令，主要包括配置运行Nginx服务器的用户（组），允许生成worker processes数，进程PID存放路径，日志存放路径和类型以及配置文件引入等。

user www-data;
# 这是nginx处理并发的关键配置，worker_processes 值越大，可以支持的并发数量也就越多，但是会受到硬件，软件等设备的制约
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;
# events块 涉及的指令主要影响nginx服务器与用户的网络连接，常用的设置包括是否开启对多worker process 下的网络连接进行序列化，是否允许同时接受多个网络连接，选取那种事件驱动模型来处理连接请求，每个word process 可以同时支持最大连接数等
events {
        worker_connections 768;
        # multi_accept on;
}
# http块 http全局块配置包括文件引入，MIME-TYPE定义，日志自定义（access_log，error_log）,连接超时时间，单链接请求数上线等 包括http全局块，server块（include 包含的文件夹中写包含的server块）
http {
        ##
        # Basic Settings
        ##
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;
        # server_tokens off;
        # server_names_hash_bucket_size 64;
        # server_name_in_redirect off;
        include /etc/nginx/mime.types;
        default_type application/octet-stream;
        ##
        # SSL Settings
        ##
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE
        ssl_prefer_server_ciphers on;
        ##
        # Logging Settings
        ##
        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;
        ##
        # Gzip Settings
        ##
        gzip on;
        # gzip_vary on;
        # gzip_proxied any;
        # gzip_comp_level 6;
        # gzip_buffers 16 8k;
        # gzip_http_version 1.1;
        # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

        ##
        # Virtual Host Configs
        ##

        include /etc/nginx/conf.d/*.conf;
        include /etc/nginx/sites-enabled/*;
}


#mail {
#       # See sample authentication script at:
#       # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
# 
#       # auth_http localhost/auth.php;
#       # pop3_capabilities "TOP" "USER";
#       # imap_capabilities "IMAP4rev1" "UIDPLUS";
# 
#       server {
#               listen     localhost:110;
#               protocol   pop3;
#               proxy      on;
#       }
# 
#       server {
#               listen     localhost:143;
#               protocol   imap;
#               proxy      on;
#       }
#}
```

**server块**

> 

```nginx
server {
        listen 80 default_server; #监听的端口号80端口
        listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _; #服务名称
        # 请求包含/时候的处理
        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                try_files $uri $uri/ =404;
        }

        # pass PHP scripts to FastCGI server
        #
        
        #location ~ \.php$ {
        #       include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
        #       fastcgi_pass unix:/run/php/php7.3-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #       deny all;
        #}
}


# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
#server {
#       listen 80;
#       listen [::]:80;
#
#       server_name example.com;
#
#       root /var/www/example.com;
#       index index.html;
#
#       location / {
#               try_files $uri $uri/ =404;
#       }
#}

```

# nginx配置实例

> location指令说明
>
> 1. = ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求。
> 2. ~：用于表示 uri 包含正则表达式，并且区分大小写。 
> 3. ~：用于表示 uri 包含正则表达式，并且不区分大小写。 
> 4. ^~：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location 块中的正则 uri 和请求字符串做匹配。 注意：如果 uri 包含正则表达式，则必须要有 ~ 或者 ~ 标识。

## 反向代理

> 实现效果打开浏览器，在地址栏中输入地址：www.123.com,跳转 www.baidu.com
>
> www.123.com 可以在/etc/hosts中添加一个虚拟域名

```nginx
#  监听本地80端口 服务名称是www.123.com  路径是 /的时候转发到 www.baidu.com
server{
   listen 80;
   server_name www.123.com;
   location / {
      root html;
      proxy_pass http://www.baidu.com;
      index index.html index.htm;
   }
}
# 重启nginx nginx -s reload
```

- 反向代理实例2

> 实现效果：使用nginx反向代理，根据访问的路径跳转到不同端口的服务中，
>
> nginx监听端口为1997
>
> 访问 www.123.com:1997/bd 直接跳转到www.baidu.com
>
> 访问www.123.com:1997/al 直接跳转到www.aliyun.com

```nginx
server{
   listen 1997;
   server_name www.123.com;
   # ~类似于正则表达式通配符 
   location ~ /bd/ {
      proxy_pass http://www.baidu.com;
   }
  location ~ /al/ {
     proxy_pass http://www.aliyun.com;   
  }  
}
```

## 负载均衡

> **概念**
>
> 增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的情况
>
> 改为将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的负载均衡
>
> **实现效果**
>
> 浏览器的地址栏输入地址 www.yaoliuyang.com 负载均衡的效果















