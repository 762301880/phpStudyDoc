# cdn 是什么 网站为什么需要cdn

### 一、CDN 的定义

CDN 的全称是 Content Delivery Network，中文叫做**内容分发网络**，是一种在互联网中部署的分布式的网络服务架构，核心是在不同的地理位置，部署很多的缓存服务器（也叫边缘节点）。

简单类比的话：可以把 CDN 理解成是电商的全国仓库网络，电商会把热门的商品，提前放在离各个买家更近的仓库里，用户下单之后，直接从最近的仓库发货，而不是全部从总仓库调货。CDN 的边缘节点就相当于这些本地仓库，网站的静态内容（比如图片、视频、JS/CSS 文件）就是这些热门商品。

### 二、网站需要 CDN 的核心原因

1. 提升网站访问速度

   普通的网站，所有的内容都存储在源服务器上，如果用户和源服务器的地理位置很远，数据传输的路径会很长，经过的网络节点很多，延迟会很高，打开网站的速度就会很慢；而 CDN 会把网站的静态内容，缓存到离用户最近的边缘节点上，用户访问的时候，直接从边缘节点获取内容，传输距离大大缩短，加载速度会有明显提升。

2. 缓解源服务器的压力

   如果网站的访问量很高，所有的请求都直接访问源服务器，源服务器的带宽、计算资源会被快速消耗，甚至会出现服务器崩溃、网站无法访问的情况；CDN 会承接大部分的静态内容请求，源服务器只需要处理动态内容的请求（比如用户的登录、提交表单），可以极大降低源服务器的负载。

3. 提升网站的稳定性和可用性

   当源服务器出现故障、或者某个地区的网络出现问题时，CDN 的边缘节点可以继续提供缓存的内容，用户依然可以正常访问网站的静态部分；同时 CDN 一般都有负载均衡和故障自动切换的机制，能避免单点故障的影响。

4. 防御网络攻击

   很多 CDN 服务商都提供基础的安全防护能力，比如可以抵御 DDoS 攻击（流量型攻击），CDN 会把恶意的流量在边缘节点就进行拦截，不会传递到源服务器，保护源服务器的安全。

### 模拟对比的方式，来帮你感受使用 CDN 和不使用 CDN 的区别

> 就模拟一个用户访问网站的全过程：

#### 模拟场景：一个位于上海的用户，访问一台部署在深圳的网站

1. **没有使用 CDN 的情况**
   1. 用户在浏览器输入网址，发送访问请求
   2. 请求先从用户的电脑，传到上海的运营商节点，之后依次经过江苏、浙江、广东的多个网络中转节点，最终到达深圳的源服务器
   3. 源服务器接收到请求之后，开始处理，把需要返回的图片、网页文件，再沿着刚才的路径，反向传回给用户
   4. 整个过程中，数据传输的路径大概有 1300 公里左右，加上每一个中转节点都需要处理数据，大概需要花费**300ms-800ms 甚至更久**的时间，你会看到浏览器的加载图标一直在转，网页的图片、内容是一点点跳出来的，要是遇到访问高峰，源服务器压力大，可能还会加载失败。
2. **使用了 CDN 的情况**
   1. 用户在浏览器输入网址，发送访问请求
   2. 请求只会传到上海本地的 CDN 边缘节点（这个节点可能就在用户所在的行政区，距离只有几十公里）
   3. 这个边缘节点上已经缓存了这个网站的图片、网页文件，直接就把内容返回给用户
   4. 整个过程数据传输的路径极短，中转节点很少，只需要花费**50ms-150ms**的时间，你打开网页的时候，几乎是瞬间就看到完整的内容，就算是访问高峰，也不会有明显的加载延迟

### 模拟**DDoS 攻击时，CDN 的防护效果对比**

模拟场景：网站遭遇针对源服务器的流量型 DDoS 攻击，攻击流量是 100Gbps

1. **没有使用 CDN 的情况**
   1. 攻击者发起的 100Gbps 的恶意流量，会直接沿着网络路径，全部冲向深圳的源服务器
   2. 普通的网站源服务器，带宽一般只有 10Gbps-50Gbps，这个攻击流量远远超过了源服务器的承载上限
   3. 源服务器的带宽会在几秒钟内被占满，不仅无法处理正常用户的访问请求，严重的话还会直接被运营商暂时封禁 IP，或者服务器硬件直接因为过载损坏
   4. 此时不管是上海的用户，还是其他地区的用户，都会直接无法打开这个网站，一直显示加载失败
2. **使用了 CDN 的情况**
   1. 攻击者发起的 100Gbps 的恶意流量，首先会冲向 CDN 的边缘节点网络
   2. CDN 的边缘节点集群整体的带宽承载能力非常高，一般可以达到 Tbps 级别（1Tbps=1024Gbps），100Gbps 的攻击流量只会占用一小部分的带宽资源
   3. 同时 CDN 的防护系统会识别出这些恶意流量，在边缘节点就直接进行拦截、清洗，不会把这些流量传递到深圳的源服务器
   4. 上海的用户，以及其他地区的正常用户，依然可以从 CDN 的边缘节点获取缓存的内容，正常访问网站，不会受到攻击的影响

### **CDN 的实际部署的简单步骤**

CDN 的实际部署，针对普通的中小网站来说，步骤是比较简单的，一般分为这几步：

1. 选择 CDN 服务商并完成注册

   先挑选合适的 CDN 服务商，国内常见的有阿里云 CDN、腾讯云 CDN、百度云加速等，完成服务商平台的账号注册和实名认证。

2. 添加需要加速的网站域名

   在 CDN 服务商的管理后台，找到 CDN 加速的入口，添加自己的网站域名，同时需要选择这个域名的业务类型，比如是静态网站、动态网站、视频网站，方便 CDN 进行针对性的配置。

3. 配置源服务器信息

   填写网站源服务器的 IP 地址或者源域名，CDN 会把这个源服务器的内容同步到边缘节点；同时可以配置缓存规则，比如指定哪些文件需要缓存、缓存的时长是多久。

4. 修改域名 DNS 解析

   这是关键的一步，需要到你的域名注册商的后台，把域名的 DNS 解析记录，从原来指向源服务器的记录，修改为指向 CDN 服务商提供的 CNAME 地址，这样用户的访问请求才会先进入 CDN 网络。

5. 验证配置并上线

   修改解析之后，等待 10 分钟 - 60 分钟的 DNS 生效时间，之后可以在 CDN 后台验证加速是否生效，也可以用浏览器访问网站，测试访问速度，确认没问题之后，CDN 就正式开始为网站提供服务了