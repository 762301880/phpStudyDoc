

# 简单介绍

在 Linux 系统中搭建堡垒机，核心思路是**部署专用的堡垒机软件**，通过集中管控 SSH/RDP 等远程访问协议，实现账号统一、权限审计、操作留痕等功能。常见的开源堡垒机方案有 **JumpServer**、**Teleport**、**GateOne** 等，其中 **JumpServer** 功能最完善、社区活跃度最高，下面以 **JumpServer 开源版**为例，详细讲解搭建步骤和底层原理。

## 一、前置条件

1. 服务器要求

   - 操作系统：推荐 CentOS 7/8、Ubuntu 18.04+（需 64 位）
   - 硬件配置：**至少 2 核 CPU、4G 内存**、20G 磁盘（生产环境建议更高）
   - 网络：服务器需能访问内网被管理机器，且开放 80/443/22 端口（按需调整）

   

2. 依赖环境

   

   JumpServer 基于 Python/Django 开发，依赖 Docker 或手动安装 MariaDB、Redis、Nginx 等组件。

   推荐使用 Docker Compose 一键部署

   ，降低环境配置复杂度。

## 二、核心原理

堡垒机本质是**跳板机 + 审计系统**，其核心工作流程：

1. **身份认证**：用户先登录堡垒机，通过账号密码 / 密钥 / MFA 等方式验证身份。
2. **权限管控**：堡垒机根据预设策略，分配用户可访问的目标机器和操作权限（如只读、读写）。
3. **会话代理**：用户通过堡垒机的 Web 界面或客户端，代理连接目标机器，所有操作流量经过堡垒机。
4. **审计留痕**：堡垒机记录所有会话的操作日志、命令记录、录屏文件，支持事后追溯和合规审计。

# 堡垒机是干嘛的

简单来说，**堡垒机是运维和服务器管理的 “安全守门人”**，核心作用是解决 “谁能访问哪些机器、做了什么操作、出问题找谁” 的核心痛点。

你可以把没有堡垒机的服务器集群，想象成一个**大门敞开、没有门卫、没有监控**的园区：

- 每个员工都能直接用钥匙（账号密码 / 密钥）打开任意房间（服务器）的门；
- 没人知道谁进了哪个房间、做了什么事；
- 一旦某个房间的东西被弄坏（比如误删数据、误改配置），根本查不到责任人；
- 要是有员工的钥匙丢了（账号泄露），所有房间都可能有风险。

而堡垒机的存在，就是给这个园区装上**统一的门禁、监控和审计系统**，具体解决这几个核心问题：

### 1. 解决 “权限混乱” 的问题

没有堡垒机时，运维人员可能要记住几十台甚至上百台服务器的账号密码，为了方便，很多人会用**统一的密码**（比如所有机器的 root 密码都一样），或者把密钥存在本地。

- 一旦某个人离职，你需要**逐个修改所有服务器的密码**，否则离职人员仍能访问；
- 新人入职，你要手动给每台机器创建账号，权限边界模糊（比如新人能随便改生产环境配置）。

堡垒机的**统一权限管控**能解决这个问题：

- 所有用户只需要一个堡垒机账号，登录堡垒机后，只能看到自己有权限的服务器；
- 可以精细化分配权限：比如运维 A 只能操作 Web 服务器，运维 B 只能操作数据库服务器，且只能执行查询命令，不能删库；
- 员工离职 / 调岗，直接在堡垒机上禁用账号即可，无需修改所有服务器的密码。

### 2. 解决 “操作无记录、出问题难追溯” 的问题

没有堡垒机时，用户直接 SSH 连接服务器，所有操作都是 “黑箱”：

- 要是有人误删了生产环境的核心数据，你根本查不到是谁干的、什么时候干的；
- 遇到配置被改乱的情况，也没法还原操作过程，排查问题耗时耗力。

堡垒机的**全程审计留痕**功能，相当于给所有操作装了 “监控摄像头”：

- 所有用户的操作都会被**实时记录**：包括执行了什么命令、修改了哪个文件、登录了多长时间；
- 支持**录屏回放**：就算是图形化操作（比如 Windows 远程桌面），也能像看视频一样回放整个操作过程；
- 出问题时，直接查堡垒机的审计日志，就能快速定位责任人、还原事故原因。

### 3. 解决 “直接暴露服务器风险” 的问题

没有堡垒机时，服务器的 22 端口（SSH）、3389 端口（RDP）通常需要对公网开放，才能让运维人员远程访问。

- 公网端口暴露，会成为黑客的攻击目标（比如暴力破解密码、扫描漏洞）；
- 一旦某台服务器的账号泄露，黑客就能直接登录，进而攻击整个内网。

堡垒机的**代理访问**机制，相当于把所有服务器的 “后门” 都关上，只留一个 “正门”：

- 所有服务器的 22/3389 端口**只对内网开放**，不暴露给公网；
- 运维人员只能通过堡垒机的 Web 界面或专用客户端，**间接访问**目标服务器，所有流量都经过堡垒机转发；
- 就算堡垒机的账号泄露，黑客也只能在堡垒机的权限范围内操作，无法直接突破到内网其他机器。

### 4. 满足合规要求

对于企业（尤其是金融、电商、政府等行业），**服务器操作审计是合规的硬性要求**。

比如等保 2.0 明确规定：“应对远程访问的行为进行记录，包括访问用户、访问时间、访问 IP、操作内容等”。

堡垒机的审计日志可以直接作为**合规检查的证据**，避免企业因不合规被处罚。

------

总结一下：**个人玩几台服务器可以不用堡垒机，但只要服务器数量≥3，或者涉及生产环境、核心数据，堡垒机就是必需品**。它不是增加了运维的麻烦，而是通过 “统一管控” 降低了安全风险和管理成本。

# jumpserver

## docker 安装

JumpServer 官方提供了一键部署脚本，自动拉取镜像并配置 Compose 文件：

```shell
# 下载并执行部署脚本
curl -sSL https://resource.fit2cloud.com/jumpserver/jumpserver/releases/latest/download/quick_start.sh | bash
```



##  安装结果

```shell
>>> The Installation is Complete
1. You can use the following command to start, and then visit
cd /opt/jumpserver-installer-v4.10.14
./jmsctl.sh start

2. Other management commands
./jmsctl.sh stop
./jmsctl.sh restart
./jmsctl.sh backup
./jmsctl.sh upgrade
For more commands, you can enter ./jmsctl.sh --help to understand

3. Web access
http://192.168.3.95:80
Default username: admin  Default password: ChangeMe        # 安装后的用户名&密码地址

 More information
Official Website: https://www.jumpserver.com/
Documentation: https://www.jumpserver.com/docs
```

