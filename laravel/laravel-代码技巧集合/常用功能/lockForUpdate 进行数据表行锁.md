#  说明

> 锁顾名思义就是例如生活中的锁，这个箱子我上了锁所以只有我自己可以操作这个
>
> 箱子，
>
> **使用场景**
>
> 并发抽奖假设一个奖项只能是剩余数量大于**0**的时候才能抽,正好有最后一个数量**1**，并发量
>
> 比较大的情况下，可能会出现**-1**的情况,这个时候就需要锁操作避免

## 资料

| 名称                                                    | 地址                                                         |
| ------------------------------------------------------- | ------------------------------------------------------------ |
| 使用 Laravel sharedLock 与 lockForUpdate 进行数据表行锁 | [link](https://www.sunzhongwei.com/using-laravel-sharedlock-and-lockforupdate-for-table-row-locks) |
| Laravel 事务中 使用 悲观锁 小结                         | [link](https://learnku.com/articles/36846)                   |
| MySQL悲观锁Laravel的实现                                | [link](https://www.jianshu.com/p/3048f3ebf761?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation) |
| PHP 高并发情况的简单模拟,thinkphp                       | [link](https://www.jianshu.com/p/a41e41834d88)               |

​	



# 实例

## mysql测试

>**begin**开启事物,这里我们没有提交事物，可以看见终端**2**处于等待状态

```sql
# sql 终端 1
mysql> begin;
Query OK, 0 rows affected (0.00 sec)

mysql> select * from stu for update;
+----+-----------+----------+---------------------+---------------------+------+
| id | sname     | class_id | birthday            | updated_at          | sex  |
+----+-----------+----------+---------------------+---------------------+------+
|  1 | 李广      |        1 | 1998-02-12 08:22:13 | 2019-07-20 14:22:16 | 男   |
|  2 | 何青      |        1 | 1985-07-22 18:19:13 | 2019-07-17 21:50:38 | 女   |
|  3 | 钱佳      |        3 | 1989-11-17 10:29:13 | 2019-07-17 20:54:14 | 男   |
|  4 | 刘玉      |        1 | 1999-07-03 19:46:13 | 2019-07-17 20:54:14 | 女   |
|  5 | 后盾人    |        2 | 2003-09-01 20:33:13 | 2019-07-20 16:41:32 | 男   |
|  6 | 张云      |        3 | 1996-09-01 20:33:13 | 2019-07-19 12:59:40 | 女   |
|  7 | 李风      |        1 | 2003-02-15 20:33:13 | 2019-07-20 14:30:02 | 男   |
|  8 | 李兰      |        2 | NULL                | 2019-07-19 12:50:07 | 女   |
|  9 | 李月      |        1 | NULL                | 2019-07-18 17:49:03 | 女   |
| 10 | 刘雷      |     NULL | 1996-11-08 20:33:13 | 2019-07-20 15:59:28 | NULL |
+----+-----------+----------+---------------------+---------------------+------+
10 rows in set (0.00 sec)

mysql> 
# sql 终端 2 
mysql> select * from stu for update;  

```

**提交事物**

> 终端**1**提交事物的时候可以看见终端**2**才可以查询到结果

```shell
# sql 终端 1
mysql> commit;
Query OK, 0 rows affected (0.00 sec)

# sql 终端 2

mysql> select * from stu for update;
+----+-----------+----------+---------------------+---------------------+------+
| id | sname     | class_id | birthday            | updated_at          | sex  |
+----+-----------+----------+---------------------+---------------------+------+
|  1 | 李广      |        1 | 1998-02-12 08:22:13 | 2019-07-20 14:22:16 | 男   |
|  2 | 何青      |        1 | 1985-07-22 18:19:13 | 2019-07-17 21:50:38 | 女   |
|  3 | 钱佳      |        3 | 1989-11-17 10:29:13 | 2019-07-17 20:54:14 | 男   |
|  4 | 刘玉      |        1 | 1999-07-03 19:46:13 | 2019-07-17 20:54:14 | 女   |
|  5 | 后盾人    |        2 | 2003-09-01 20:33:13 | 2019-07-20 16:41:32 | 男   |
|  6 | 张云      |        3 | 1996-09-01 20:33:13 | 2019-07-19 12:59:40 | 女   |
|  7 | 李风      |        1 | 2003-02-15 20:33:13 | 2019-07-20 14:30:02 | 男   |
|  8 | 李兰      |        2 | NULL                | 2019-07-19 12:50:07 | 女   |
|  9 | 李月      |        1 | NULL                | 2019-07-18 17:49:03 | 女   |
| 10 | 刘雷      |     NULL | 1996-11-08 20:33:13 | 2019-07-20 15:59:28 | NULL |
+----+-----------+----------+---------------------+---------------------+------+
10 rows in set (3.45 sec)

mysql> 
```

**注意事项:** ***必须在事务中上锁才会生效***



## laravel

# 日后补充