# 	说明

> 类似于淘宝类别，做商城api的时候我们需要编写这种类别接口我们默认只有三级

<img src="https://i.loli.net/2021/08/02/Zvo6MFxeUAm5sJO.png" alt="1627884931.jpg" style="zoom:80%;" />





# 代码示例



## 创建数据库

### sql-ddl

```sql
CREATE TABLE `categories` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '分类名称',
  `pid` int(11) NOT NULL DEFAULT '0' COMMENT '父级,一级分类默认为0',
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态 0禁用 1启用',
  `level` tinyint(4) NOT NULL DEFAULT '1' COMMENT '分类等级 1 2 3',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='类别表';
```

### 使用laravel迁移

- 使用artisan 命令创建迁移数据库

  > 此命令会在 `database\migrations\2021_08_02_061834_create_categories_table.php`

```php
php artisan make:migration create_categories_table
```

- 在up方法中编辑

  ```shell
   public function up()
      {
          Schema::create('categories', function (Blueprint $table) {
              $table->id();
              $table->string('name')->comment('分类名称');
              $table->integer('pid')->default(0)->comment('父级,一级分类默认为0');
              $table->tinyInteger('status')->default(1)->comment('状态 0禁用 1启用');
              $table->tinyInteger('level')->default(1)->comment('分类等级 1 2 3');
              $table->timestamps();
          });
   # 添加表注释       
   \Illuminate\Support\Facades\DB::statement("alter table `categories` comment'类别表'");
  }
  ```

- 执行迁移命令

```php
php artisan migrate
```

### 创建models

> 在app\Models 中创建**Categories.php**模型

```shell
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Categories extends Model
{
    protected $table = 'categories';
    protected $fillable = ['name', 'pid', 'status', 'level'];
}
  # 分类的字类
public function children()
{
    return $this->hasMany(Categories::class,'pid','id');
}
```

## 创建类别资源路由

- 在`routes\api.php`中创建路由

```shell
# 分类管理资源路由
$api->resource('category',\App\Http\Controllers\CategoryController::class);
```

- 创建类别资源控制器

```shell
php artisan make:controller CategoryController --resource
```



### 对应的类别curd

#### 添加分类 ***store***

> 请求方法 post

```shell
    public function store(Request $request)
    {
        $validator = Validator::make($request->all(),
            [
                'name' => 'required',
                'pid' => 'nullable|integer',
                'status' => 'required|integer|between:0,1',
                'level' => 'nullable|integer|between:1,3',
            ],
            [
                'name.required' => '分类名称是必须的',
                'pid.required' => '父级id必须是整数',
                'status.required' => '状态是必须的',
                'status.integer' => '状态必须是整数',
                'status.between' => '状态必须是0或1',
                'level.integer' => '等级必须是整数',
                'level.between' => '等级必须是1到3',
            ],
        );
        if ($validator->fails()) {
            return response()->json($validator->errors());
        }
        $categories = new Categories();
        $categories->name = $request->input('name');
        $categories->pid = $request->input('pid') ?? 0;
        # 如果等级父级id为0 则自己是一级分类,反之则正好是父级等级+1是自己的等级
        $categories->level = $request->input('pid') == 0 ? 1 : Categories::find($request->input('pid'))->level + 1;
        if ($categories->save()) {
            return response()->json([['error' => '创建分类成功']]);
        }
        return response()->json([['error' => '创建分类失败']]);
    }
```

获取分类详情***index***

> 请求方法get

```shell
```





