#  资料

| 名称             | 地址                                                         |
| ---------------- | ------------------------------------------------------------ |
| 小米商城分类参考 | [link])(https://www.woshipm.com/pd/4677653.html/comment-page-1) [link](https://m.mi.com/category) |



# 	说明

> 类似于淘宝类别，做商城api的时候我们需要编写这种类别接口我们默认只有三级

<img src="https://yaoliuyang-blog-images.oss-cn-beijing.aliyuncs.com/blogImages/Zvo6MFxeUAm5sJO.png" alt="1627884931.jpg" style="zoom:80%;" />





# 代码示例



## 创建数据库

### sql-ddl

```sql
CREATE TABLE `categories` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT '分类名称',
  `pid` int(11) NOT NULL DEFAULT '0' COMMENT '父级,一级分类默认为0',
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '状态 0禁用 1启用',
  `level` tinyint(4) NOT NULL DEFAULT '1' COMMENT '分类等级 1 2 3',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='类别表';
```

### 使用laravel迁移

- 使用artisan 命令创建迁移数据库

  > 此命令会在 `database\migrations\2021_08_02_061834_create_categories_table.php`

```php
php artisan make:migration create_categories_table
```

- 在up方法中编辑

  ```shell
   public function up()
      {
          Schema::create('categories', function (Blueprint $table) {
              $table->id();
              $table->string('name')->comment('分类名称');
              $table->integer('pid')->default(0)->comment('父级,一级分类默认为0');
              $table->tinyInteger('status')->default(1)->comment('状态 0禁用 1启用');
              $table->tinyInteger('level')->default(1)->comment('分类等级 1 2 3');
              $table->timestamps();
          });
   # 添加表注释       
   \Illuminate\Support\Facades\DB::statement("alter table `categories` comment'类别表'");
  }
  ```

- 执行迁移命令

```php
php artisan migrate
```

### 创建models

> 在app\Models 中创建**Categories.php**模型

```shell
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Categories extends Model
{
    protected $table = 'categories';
    protected $fillable = ['name', 'pid', 'status', 'level'];
}
  # 分类的字类
public function children()
{
    return $this->hasMany(Categories::class,'pid','id');
}
```

## 创建类别资源路由

- 在`routes\api.php`中创建路由

```shell
# 分类管理资源路由 ['except'=>['destroy']] 排除不需要的路由 only 等常用方法
$api->resource('category',\App\Http\Controllers\CategoryController::class,['except'=>['destroy']]);
```

- 创建类别资源控制器

```shell
php artisan make:controller CategoryController --resource # c
# 或则
php artisan make:controller CategoryController --api # 创建api路由
```



### 对应的类别curd

#### 添加分类 ***store***

> 请求方法 post

```shell
    public function store(Request $request)
    {
        $validator = Validator::make($request->all(),
            [
                'name' => 'required',
                'pid' => 'nullable|integer',
                'status' => 'required|integer|between:0,1',
                'level' => 'nullable|integer|between:1,3',
            ],
            [
                'name.required' => '分类名称是必须的',
                'pid.required' => '父级id必须是整数',
                'status.required' => '状态是必须的',
                'status.integer' => '状态必须是整数',
                'status.between' => '状态必须是0或1',
                'level.integer' => '等级必须是整数',
                'level.between' => '等级必须是1到3',
            ],
        );
        if ($validator->fails()) {
            return response()->json($validator->errors());
        }
        $categories = new Categories();
        $categories->name = $request->input('name');
        $categories->pid = $request->input('pid') ?? 0;
        # 如果等级父级id为0 则自己是一级分类,反之则正好是父级等级+1是自己的等级
        $categories->level = $request->input('pid') == 0 ? 1 : Categories::find($request->input('pid'))->level + 1;
        if ($categories->save()) {
            return response()->json([['error' => '创建分类成功']]);
        }
        return response()->json([['error' => '创建分类失败']]);
    }
```

获取分类详情***index***

> 请求方法get

```shell
    public function index(Request $request)
    {
        $status = $request->input('status');# 查询启用状态
        $categories = Categories::select(['id', 'pid', 'name', 'level']) # 约定一级显示的东西
        ->when(!empty($status), function ($query) use ($status) {
            $query->where('status', $status);
        })
            ->where('pid', 0) # 默认最外层只显示一级
            ->with([
                'children:id,pid,name', # 约定二级显示的参数
                'children.children' => function ($query) use ($status) {
                    $query->when(!empty($status), function ($query) use ($status) {
                        $query->where('status', $status); # 查询启用状态
                        $query->select(['id', 'pid', 'name']); # 选择需要的字段三级
                    });
                }# 约定三级显示的东西
            ])
            ->get();
        return response()->json(compact('categories'));
    }
```



## [**H5端分类**](http://v4.crmeb.net/pages/goods_cate/goods_cate)

![image-20230130090224204](https://yaoliuyang-blog-images.oss-cn-beijing.aliyuncs.com/blogImages/image-20230130090224204.png)

**数据结构**

```php
{
    "status":200,
    "msg":"success",
    "data":[
        {
            "id":53,
            "pid":0,
            "cate_name":"官方商城",
            "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/20211116\/824a04a0e24bcb86d13e2a8ddc7d84dd.png",
            "big_pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/20211116\/824a04a0e24bcb86d13e2a8ddc7d84dd.png",
            "children":[
                {
                    "id":426,
                    "cate_name":"anta",
                    "pic":"",
                    "big_pic":""
                },
                {
                    "id":82,
                    "cate_name":"vans",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/20211115\/bb948cb243c5de122bb16357675a675b.png",
                    "big_pic":""
                },
                {
                    "id":72,
                    "cate_name":"双星",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/02\/4cd4e20c2bb96d32f0fc9d42e784fbe7.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/26643185e7c4f818da86c50f5c10b4c4.jpg"
                },
                {
                    "id":71,
                    "cate_name":"贵人鸟",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/d98f44760a3249a523482332811bae90.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/d98f44760a3249a523482332811bae90.jpg"
                },
                {
                    "id":70,
                    "cate_name":"回力",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/f466b8bbf8624f65fdab9d015e7d1829.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/f466b8bbf8624f65fdab9d015e7d1829.jpg"
                },
                {
                    "id":69,
                    "cate_name":"鸿星尔克",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/46aeb79196eb813d8d45cd1751281b78.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/46aeb79196eb813d8d45cd1751281b78.jpg"
                },
                {
                    "id":68,
                    "cate_name":"卡帕",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/048efeae2771b83230ea6a3494c5e24f.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/048efeae2771b83230ea6a3494c5e24f.jpg"
                },
                {
                    "id":67,
                    "cate_name":"美津侬",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/5c1df7f18f66a93f96e509a4fef557e1.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/5c1df7f18f66a93f96e509a4fef557e1.jpg"
                },
                {
                    "id":66,
                    "cate_name":"锐步",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/385bc821aed0e9612b5c4f6a12c911b9.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/385bc821aed0e9612b5c4f6a12c911b9.jpg"
                },
                {
                    "id":65,
                    "cate_name":"乔丹",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/1e50cfdfb14a920ff2afed365ee324f4.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/1e50cfdfb14a920ff2afed365ee324f4.jpg"
                },
                {
                    "id":64,
                    "cate_name":"361",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/0c7ca46ee84ef0d54f5096ad3d4966b6.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/0c7ca46ee84ef0d54f5096ad3d4966b6.jpg"
                },
                {
                    "id":63,
                    "cate_name":"特步",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/f4670fd2e386daffa005f7ae9beb1c9a.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/f4670fd2e386daffa005f7ae9beb1c9a.jpg"
                },
                {
                    "id":62,
                    "cate_name":"匹克",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/ba65ba7d76057e26e8db479145db52ae.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/ba65ba7d76057e26e8db479145db52ae.jpg"
                },
                {
                    "id":61,
                    "cate_name":"安踏",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/cf80f09fea958f9e5e5ad8ae817e2145.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/cf80f09fea958f9e5e5ad8ae817e2145.jpg"
                },
                {
                    "id":60,
                    "cate_name":"斐乐",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/7bb39c79ded9fa4bec8d8a277e7f3772.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/7bb39c79ded9fa4bec8d8a277e7f3772.jpg"
                },
                {
                    "id":59,
                    "cate_name":"李宁",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/a14444850285d9d05b4b01c24f0d975a.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/a14444850285d9d05b4b01c24f0d975a.jpg"
                },
                {
                    "id":57,
                    "cate_name":"阿迪达斯",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/9db0d4906fac5f9f766b16c1ce01bdf3.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/9db0d4906fac5f9f766b16c1ce01bdf3.jpg"
                },
                {
                    "id":56,
                    "cate_name":"新百伦",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/09e8d12dc7a3d56eee8306eb34606a07.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/09e8d12dc7a3d56eee8306eb34606a07.jpg"
                },
                {
                    "id":55,
                    "cate_name":"耐克",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/b29c89da80f486fb3fe4be307afe569c.jpg",
                    "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201014\/b29c89da80f486fb3fe4be307afe569c.jpg"
                },
                {
                    "id":54,
                    "cate_name":"新品上市",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/08\/20200825\/d868c5367cbf6501343364fe2ea452bf.jpg",
                    "big_pic":""
                }
            ]
        },
        {
            "id":8,
            "pid":0,
            "cate_name":"电子产品",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce67cb47cf3e.jpg",
            "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201013\/d2a316f8e8dd3b8ba4335c8197fb4ff2.png",
            "children":[
                {
                    "id":36,
                    "cate_name":"电脑",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63dc10cba6.png",
                    "big_pic":""
                },
                {
                    "id":37,
                    "cate_name":"手机",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63ded4251d.png",
                    "big_pic":""
                },
                {
                    "id":38,
                    "cate_name":"配件耗材",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63e7c819ba.png",
                    "big_pic":""
                },
                {
                    "id":81,
                    "cate_name":"手表配饰",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/20211115\/66ae80de3aa3ca7ad390131cd92dc32b.png",
                    "big_pic":""
                }
            ]
        },
        {
            "id":1,
            "pid":0,
            "cate_name":"家用电器",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce67494ba063.jpg",
            "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201013\/ac3afff89b11579477fec875f215422a.png",
            "children":[
                {
                    "id":10,
                    "cate_name":"生活家电",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce6192f88c26.jpg",
                    "big_pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/20211116\/20494298146fb2d226fb635bab1f4c8f.jpg"
                },
                {
                    "id":11,
                    "cate_name":"小家电",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce619be8d613.png",
                    "big_pic":""
                },
                {
                    "id":13,
                    "cate_name":"厨房大电",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61b83b2b66.png",
                    "big_pic":""
                },
                {
                    "id":14,
                    "cate_name":"卫浴电器",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61bd7708d9.png",
                    "big_pic":""
                },
                {
                    "id":12,
                    "cate_name":"卫浴清洁",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61a5796050.png",
                    "big_pic":""
                },
                {
                    "id":215,
                    "cate_name":"小小家电",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2022\/02\/08\/04cc07d6f36ad218a7fd336b0b40eb82.jpg",
                    "big_pic":""
                },
                {
                    "id":15,
                    "cate_name":"净化污染",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61c3295999.png",
                    "big_pic":""
                }
            ]
        },
        {
            "id":3,
            "pid":0,
            "cate_name":"家具软装",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce676b9d1321.jpg",
            "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201013\/9558cf872c5d357db73afc7f2c3b9f77.png",
            "children":[
                {
                    "id":22,
                    "cate_name":"居家家具",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce6208cf3d21.png",
                    "big_pic":""
                },
                {
                    "id":23,
                    "cate_name":"光源照明",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce620de405bf.png",
                    "big_pic":""
                },
                {
                    "id":24,
                    "cate_name":"家饰软装",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce62122c5596.png",
                    "big_pic":""
                },
                {
                    "id":345,
                    "cate_name":"床",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2022\/10\/20221020\/2108ad7ec301376b58b5eef9db0800a5.png",
                    "big_pic":""
                }
            ]
        },
        {
            "id":7,
            "pid":0,
            "cate_name":"运动器材",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce6779d7f2a6.jpg",
            "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201013\/1723f8c48fd0fa34f45947a14fe98111.png",
            "children":[
                {
                    "id":25,
                    "cate_name":"健身体育",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce621a572e3e.png",
                    "big_pic":""
                },
                {
                    "id":26,
                    "cate_name":"运动服饰",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce621dc41bc0.png",
                    "big_pic":""
                },
                {
                    "id":27,
                    "cate_name":"户外装备",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce62206f10cb.png",
                    "big_pic":""
                },
                {
                    "id":44,
                    "cate_name":"车载电器",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce6405a35beb.png",
                    "big_pic":""
                },
                {
                    "id":43,
                    "cate_name":"骑行配件",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce64016d056a.png",
                    "big_pic":""
                },
                {
                    "id":28,
                    "cate_name":"出行车品",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce6225beb050.png",
                    "big_pic":""
                }
            ]
        },
        {
            "id":6,
            "pid":0,
            "cate_name":"美妆个护",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63b393f1f0.png",
            "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201013\/1e13cf47fd7f0476b204579e9816cf60.png",
            "children":[
                {
                    "id":29,
                    "cate_name":"口腔清洁",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63a3d96929.jpg",
                    "big_pic":""
                },
                {
                    "id":30,
                    "cate_name":"美妆工具",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63a7f8a15b.png",
                    "big_pic":""
                },
                {
                    "id":31,
                    "cate_name":"护肤护理",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63afb81671.png",
                    "big_pic":""
                },
                {
                    "id":32,
                    "cate_name":"彩妆香氛",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63b393f1f0.png",
                    "big_pic":""
                },
                {
                    "id":79,
                    "cate_name":"包包",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/20211113\/747a6efc7df9fc45859de767c412114a.png",
                    "big_pic":""
                },
                {
                    "id":45,
                    "cate_name":"按摩器械",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce640f3094e9.png",
                    "big_pic":""
                }
            ]
        },
        {
            "id":4,
            "pid":0,
            "cate_name":"居家餐厨",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce67625a7b91.jpg",
            "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201013\/ac3afff89b11579477fec875f215422a.png",
            "children":[
                {
                    "id":33,
                    "cate_name":"床品件套",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63bf08f630.png",
                    "big_pic":""
                },
                {
                    "id":34,
                    "cate_name":"家饰摆件",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63c2f1bd05.png",
                    "big_pic":""
                },
                {
                    "id":35,
                    "cate_name":"餐厨锅具",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63c6d6ddc1.png",
                    "big_pic":""
                }
            ]
        },
        {
            "id":2,
            "pid":0,
            "cate_name":"电视影音",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61ec2a0491.png",
            "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201013\/f1223c0a864ea44322f5a934deb723b4.png",
            "children":[
                {
                    "id":19,
                    "cate_name":"电视",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61ec2a0491.png",
                    "big_pic":""
                },
                {
                    "id":16,
                    "cate_name":"投影",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61e0d501d4.png",
                    "big_pic":""
                },
                {
                    "id":17,
                    "cate_name":"音箱",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61e50d5101.png",
                    "big_pic":""
                },
                {
                    "id":18,
                    "cate_name":"耳机",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/20211115\/99c9c827afe1ee0da760f34684a90fbd.png",
                    "big_pic":""
                },
                {
                    "id":20,
                    "cate_name":"麦克风",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61f0549a18.png",
                    "big_pic":""
                },
                {
                    "id":21,
                    "cate_name":"影音周边",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce61f3584517.png",
                    "big_pic":""
                }
            ]
        },
        {
            "id":9,
            "pid":0,
            "cate_name":"日用文创",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce678cb80108.jpg",
            "big_pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/10\/20201013\/f1223c0a864ea44322f5a934deb723b4.png",
            "children":[
                {
                    "id":39,
                    "cate_name":"清洁用具",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/01\/0662ac457832b41520d9a1171cf006e5.jpg",
                    "big_pic":""
                },
                {
                    "id":40,
                    "cate_name":"日用杂货",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63ef9bddcb.png",
                    "big_pic":""
                },
                {
                    "id":41,
                    "cate_name":"工具",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2019\/05\/23\/5ce63f20e146e.png",
                    "big_pic":""
                },
                {
                    "id":84,
                    "cate_name":"文化用品",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/17\/061178a15d3f452adae93abcf97161ec.jpg",
                    "big_pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/08\/20200825\/d868c5367cbf6501343364fe2ea452bf.jpg"
                }
            ]
        },
        {
            "id":428,
            "pid":0,
            "cate_name":"蔬菜1",
            "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2023\/01\/20230111\/7e37f659d719470a4686d9eccc73b75a.png",
            "big_pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2023\/01\/20230111\/6ea14c966843c99fea29bebeec28886e.jpg",
            "children":[

            ]
        },
        {
            "id":427,
            "pid":0,
            "cate_name":"蔬菜",
            "pic":"",
            "big_pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2023\/01\/20230111\/b4751472fde4a9d6376745690e61a65e.png",
            "children":[

            ]
        },
        {
            "id":425,
            "pid":0,
            "cate_name":"顶级菜单测试1",
            "pic":"",
            "big_pic":"",
            "children":[

            ]
        },
        {
            "id":49,
            "pid":0,
            "cate_name":"时尚服装",
            "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/08\/20200818\/360203f5ff8b9bcf1032d087cd0297e6.png",
            "big_pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2022\/01\/20220126\/ac2cc382a08c8f25610998f1c48a8cad.png",
            "children":[
                {
                    "id":96,
                    "cate_name":"时尚服装",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/12\/20211210\/e0ccd5a9103909277f328747b40c5ccf.jpg",
                    "big_pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/12\/20211210\/97800f14d4241e6c6c29509e7c729780.jpg"
                },
                {
                    "id":83,
                    "cate_name":"帽子",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/11\/20211116\/86e815992a8f9b1246c0b643a2983793.png",
                    "big_pic":""
                },
                {
                    "id":77,
                    "cate_name":"上衣",
                    "pic":"https:\/\/demo26.crmeb.net\/uploads\/attach\/2021\/09\/03\/c4d09ac13d579f5860ced44f8fb86c69.jpg",
                    "big_pic":""
                },
                {
                    "id":50,
                    "cate_name":"大衣",
                    "pic":"http:\/\/demo26.crmeb.net\/uploads\/attach\/2020\/08\/20200818\/26e3bd824ad0755e4aec88370d79fea2.jpg",
                    "big_pic":""
                }
            ]
        }
    ]
}
```

## 扩展



商品分类设计是一种将产品分类为相似的类别的过程，以便客户可以更轻松和有效地找到他们需要的商品。商品分类设计的关键是以客户为中心，将商品划分为对他们有意义的类别。

以下是商品分类设计的几个步骤：

1. 收集数据：首先需要确定有哪些商品需要被分类。收集商品数据可以来自相关部门，例如采购、销售、库存、物流等。

2. 确定分类目录：通过确定分类目录来规划如何组织和命名商品。分类目录应该是明确的、易于理解的并且不会造成混淆。

3. 制定规则：根据收集的数据和确定的分类目录，制定一些规则来确定商品所属的类别。例如，可以根据产品类型、用途、品牌、价格、尺寸、材料等不同维度制定分类规则。

4. 进行测试：将规则应用于实际的商品数据，并进行测试以确保正确性。可以选择一小部分商品分析测试，或者与客户一起测试以确认其易用性。

5. 实施：将分类规则应用于所有商品，并确保它们能够被正确地分类和检索。

商品分类设计的好处包括提高产品检索效率、提高客户满意度、增加销售额并提高店铺整体可用性。

## 来自你的消息:

能给出示例php代码和mysql数据库设计吗

## 来自ChatAI的消息:

下面是一个简单的PHP代码示例和MySQL数据库设计示例，用于商品分类的管理和浏览。这个示例使用了基本的CRUD（创建、读取、更新、删除）操作。

MySQL数据库设计：

```MySQL
CREATE TABLE `categories` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `parent_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `categories_parent_fk` FOREIGN KEY (`parent_id`) REFERENCES `categories` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

这个设计中有一个表格categories，每个分类都有一个id，一个名称，一个可选的描述，以及一个可选的parent_id用来表示所属的父分类。这个设计允许嵌套分类结构，因为每个分类可以有一个父分类。

PHP代码：

```php
<?php
$con = mysqli_connect("localhost","user","password","database");

// 检查连接
if (mysqli_connect_errno()) {
  echo "Failed to connect to MySQL: " . mysqli_connect_error();
  exit();
}

// 添加分类
if(isset($_POST['name'])) {
    $name = $_POST['name'];
    $description = $_POST['description'];
    $parent_id = $_POST['parent_id'];
    $query = "INSERT INTO categories (name, description, parent_id) VALUES ('$name', '$description', '$parent_id')";
    mysqli_query($con, $query);
    header('Location: index.php');
    exit();
}

// 查询分类
$query = "SELECT * FROM categories";
$result = mysqli_query($con, $query);

// 显示分类列表
while($row = mysqli_fetch_assoc($result)) {
    echo '<h2>' . $row['name'] . '</h2>';
    echo '<p>' . $row['description'] . '</p>';
    // 删除分类
    echo '<form method="post">';
    echo '<input type="hidden" name="id" value="' . $row['id'] . '">';
    echo '<button type="submit" name="delete">Delete</button>';
    echo '</form>';
}

// 删除分类
if(isset($_POST['delete'])) {
    $id = $_POST['id'];
    $query = "DELETE FROM categories WHERE id=$id";
    mysqli_query($con, $query);
}
```

这个代码会连接到MySQL数据库，并提供添加、查询和删除分类的功能。添加分类的表单可以通过HTML来实现。

这个示例代码应该只用于理解MySQL数据库和PHP代码如何协同工作，具体实现中需要考虑安全性、性能和用户体验等方面。

## 来自你的消息:

那么商品分类如何和商品关联起来呢  建议采用第三章表多对多的将分类表与商品表关联起来

## 来自ChatAI的消息:

为了将商品与其所属的分类关联起来，需要在数据库中创建另一个表格来存储商品数据，并在该表格中包含引用categories表格的外键。下面是一个示例设计：

```MySQL
CREATE TABLE `products` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `description` varchar(255) DEFAULT NULL,
  `price` decimal(10,2) NOT NULL,
  `category_id` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `products_category_fk` FOREIGN KEY (`category_id`) REFERENCES `categories` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

这个设计中products表格包含商品的id、名称、描述、价格和其所属的category_id。category_id是指向categories表格中相应分类的外键。使用外键可以确保商品只能被分配给当前存在的分类，并且可以随着分类的变化自动更新商品的分类。

要将商品与其所属的分类联系起来，可以在添加新商品时，通过表单选择商品所属的分类。在处理商品数据时，可以使用JOIN操作查询展示商品及其分类名称，示例代码如下：

```MySQL
SELECT products.id, products.name, products.description, products.price, categories.name AS category_name 
FROM products 
JOIN categories ON products.category_id = categories.id;
```

以上代码使用了JOIN操作将products表格中的数据和categories表格中的数据（通过外键关联）进行联结，同时使用别名将categories表格中的name字段重命名为category_name。这样查询结果可以同时包含商品和其所属的分类名称。

当然，在具体实现中，还需要考虑商品和分类之间的多对多关系，以及如何在前端页面实现分类浏览和管理功能。





# 实战示例

## 数据表

**商品类别表**

```sql
CREATE TABLE `categories` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL COMMENT '分类名称',
  `p_id` int NOT NULL DEFAULT '0' COMMENT '父级,一级分类默认为0',
  `level` tinyint(1) NOT NULL DEFAULT '1' COMMENT '分类等级 1 2 3',
  `create_time` datetime DEFAULT NULL,
  `update_time` datetime DEFAULT NULL,
  `sort` int NOT NULL DEFAULT '100' COMMENT '排序 数字越小越靠前 ',
  `store_id` int DEFAULT NULL COMMENT '预留门店id',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='商品类别表';
```

**商品表**

```sql
CREATE TABLE `products` (
  `id` int NOT NULL AUTO_INCREMENT,
  `title` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '商品名称',
  `description` text COMMENT '商品详情',
  `image` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT '商品图片',
  `price` decimal(10,2) NOT NULL COMMENT '商品单价',
  `status` tinyint(1) DEFAULT NULL COMMENT '商品上架状态 1 上架 -1下架',
  `on_sale` tinyint(1) DEFAULT '1' COMMENT '商品是否正在售卖(售馨)  1 销售 -1 关闭销售',
  `sort` int NOT NULL DEFAULT '100' COMMENT '排序',
  `admin_id` int DEFAULT NULL COMMENT '添加商品的后台管理员id',
  `store_id` int DEFAULT NULL COMMENT '门店相关',
  `create_time` datetime DEFAULT NULL,
  `update_time` datetime DEFAULT NULL,
  `delete_time` datetime DEFAULT NULL,
  `categories_id` tinyint(1) DEFAULT NULL COMMENT '分类id',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=42 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='商品表';
```

**商品分类关联表**

```sql
CREATE TABLE `products_categories` (
  `id` int NOT NULL AUTO_INCREMENT,
  `products_id` int NOT NULL COMMENT '商品id',
  `categories_id` int NOT NULL COMMENT '分类id',
  `create_time` datetime DEFAULT NULL,
  `update_time` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='商品绑定的分类';
```



**小程序分类逻辑示例**

```php
 //小程序等api请求

    public static function query($data = [])
    {
        return CategoriesModel::where(function (Query $query) use ($data) {
            $level = $data['level'] ?? "";
            $store_id = $data['store_id'] ?? "";
            if (!empty($level)) $query->where('level', $level);
            if (!empty($store_id)) $query->where('store_id', $store_id);
        });
    }
 public static function getQueryList($data = []) //返回分类查询列表
    {       
if (getModuleName() == 'api') {
            $list = self::query()->with(['children' => function (Query $query) use ($store_id) {
                $query->order('sort', 'ASC');
                $query->order('store_id', $store_id);
                $query->with(['products'=>function(Query $query)use ($store_id){
                    $query->where('status', ProductsModel::STATUS_UP);//返回上架的商品
                    $query->order('sort', 'ASC');
                }]);
            }])
                ->where('p_id', 0)
                ->where('store_id', $store_id)
                ->order('sort', 'ASC')
                ->paginate($limit);
        }
 }
```

**返回数据示例**

```php
{
    "code": 200,
    "msg": "分类列表返回成功",
    "data": {
        "total": 2,
        "per_page": 10,
        "current_page": 1,
        "last_page": 1,
        "data": [
            {
                "id": 4,
                "name": "男神滋补汤系列",
                "p_id": 0,
                "level": 1,
                "create_time": "2023-06-01 11:24:31",
                "update_time": "2023-06-01 11:49:35",
                "sort": 99,
                "store_id": 1,
                "children": [
                    {
                        "id": 8,
                        "name": "元气滋补汤系列二",
                        "p_id": 4,
                        "level": 2,
                        "create_time": "2023-06-01 11:49:55",
                        "update_time": "2023-06-01 11:49:55",
                        "sort": 66,
                        "store_id": 1,
                        "products": [
                            {
                                "id": 37,
                                "title": "三鞭霸王汤 鞭汤",
                                "description": "瓦罐之妙在于xxxxx",
                                "image": "http://www.sb.com/upload/20230602/647948dcd542e@3e9a400712bff6f14aad3468e5c1425d.jpeg",
                                "price": "228.00",
                                "status": 1,
                                "on_sale": 1,
                                "sort": 100,
                                "admin_id": 1,
                                "store_id": 1,
                                "create_time": "2023-06-03 15:05:21",
                                "update_time": "2023-06-03 15:05:21",
                                "delete_time": null,
                                "pivot": {
                                    "id": 2,
                                    "products_id": 37,
                                    "categories_id": 8,
                                    "create_time": "2023-06-03 15:15:45",
                                    "update_time": "2023-06-03 15:15:45"
                                }
                            }
                        ]
                    },
                    {
                        "id": 6,
                        "name": "男神滋补汤系列",
                        "p_id": 4,
                        "level": 2,
                        "create_time": "2023-06-01 11:25:31",
                        "update_time": "2023-06-01 11:25:31",
                        "sort": 100,
                        "store_id": 1,
                        "products": []
                    }
                ]
            },
            {
                "id": 1,
                "name": "猛男日记",
                "p_id": 0,
                "level": 1,
                "create_time": "2023-06-01 10:57:08",
                "update_time": "2023-06-01 10:58:08",
                "sort": 100,
                "store_id": 1,
                "children": [
                    {
                        "id": 2,
                        "name": "猛男日记",
                        "p_id": 1,
                        "level": 2,
                        "create_time": "2023-06-01 10:58:24",
                        "update_time": "2023-06-01 10:58:24",
                        "sort": 100,
                        "store_id": 1,
                        "products": [
                            {
                                "id": 37,
                                "title": "三鞭霸王汤 鞭汤",
                                "description": "瓦罐之妙在于xxxxx",
                                "image": "http://www.sb.com/upload/20230602/647948dcd542e@3e9a400712bff6f14aad3468e5c1425d.jpeg",
                                "price": "228.00",
                                "status": 1,
                                "on_sale": 1,
                                "sort": 100,
                                "admin_id": 1,
                                "store_id": 1,
                                "create_time": "2023-06-03 15:05:21",
                                "update_time": "2023-06-03 15:05:21",
                                "delete_time": null,
                                "pivot": {
                                    "id": 1,
                                    "products_id": 37,
                                    "categories_id": 2,
                                    "create_time": "2023-06-03 15:15:12",
                                    "update_time": "2023-06-03 15:15:12"
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    }
}
```



## 对应模型

**商品分类模型关联**

```php
<?php


namespace app\common\model;

use think\model\Pivot;

class ProductsCategoriesModel extends Pivot
{
    protected $table='products_categories';
    protected $autoWriteTimestamp = false;
}
```

**商品模型**

```php
<?php


namespace app\common\model;


use app\common\service\ImageService;
use app\common\traits\ModelExtensionMethod;
use think\Model;
use think\model\concern\SoftDelete;

class ProductsModel extends Model
{
    use ModelExtensionMethod, SoftDelete;

    protected $table = 'products';
    protected $autoWriteTimestamp = true;

    /**
     * 商品状态:上架
     */
    const STATUS_UP = 1;
    /**
     * 商品状态:下架
     */
    const STATUS_DOWN = -1;

    const SORT_DEFAULT = 100;

    const ON_SALE_OPEN = 1;
    const ON_SALE_CLOSE = -1;

    public static function getStatusArr($status = null)
    {
        $arr = [self::STATUS_UP => '上架', self::STATUS_DOWN => '下架'];
        if (!empty($status)) return $arr[$status] ?? "";
        return array_keys($arr);
    }

    public static function getStatusText($status)
    {
        $text = self::getStatusArr($status);
        return is_array($text) ? "" : $text;
    }

    public static function getOnSaleArr($on_sale = null)
    {
        $arr = [self::ON_SALE_OPEN => '售馨', self::ON_SALE_CLOSE => '关闭'];
        if (!empty($on_sale)) return $arr[$on_sale] ?? "";
        return array_keys($arr);
    }

    public static function getOnSaleText($on_sale)
    {
        $text = self::getOnSaleArr($on_sale);
        return is_array($text) ? "" : $text;
    }

    /**
     * 返回图片获取器
     * @param $value
     * @return string
     */
    public function getImageAttr($value)
    {
        if (empty($value)) return "";
        return ImageService::getUrlImg($value);
    }
}
```

**分类模型**

```php
<?php


namespace app\common\model;


use app\common\traits\ModelExtensionMethod;
use think\Model;

class CategoriesModel extends Model
{
    use ModelExtensionMethod;

    protected $table = 'categories';
    protected $autoWriteTimestamp = true;

    const SORT_DEFAULT = 100;


    # 分类的字类
    public function children()
    {
        return $this->hasMany(self::class, 'p_id', 'id');
    }
    public function products(){
        return $this->belongsToMany(ProductsModel::class,ProductsCategoriesModel::class,
            'products_id','categories_id');
    }
}
```

