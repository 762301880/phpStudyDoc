#   说明

> 例如以下一张sql表财务是最高级的父类 如图所示  财务下面有1162 1165   ，1162下面还有 1163  1164 无限分类
>
> 这种 我如何只去取 父类id下的id呢

![1642491898(1).jpg](https://yaoliuyang-blog-images.oss-cn-beijing.aliyuncs.com/blogImages/sX9bont5BcKrxAl.png)

## **代码示例**

```php
 /**
     * @param int $masterParentId 最高级的父级id
     */
    protected function getRbacMenuSonIds($masterParentId)
    {
        static $ids = [];
        $rbacMenu = RbacMenu::where(['parent_id' => $masterParentId])->pluck('id');
        if ($rbacMenu == null) {
            unset($rbacMenu);
        } else {
            # 递归遍历
            foreach ($rbacMenu as $key => $value) {
                $ids[] = $value;
                $this->getRbacMenuSonIds($value);
            }
        }
        if ($ids != []) {
            return array_values($ids);
        }
        return false;
    }
# 返回实例
array:5 [
  0 => 1162
  1 => 1163
  2 => 1164
  3 => 1165
  4 => 1166
]
```

## **简化版**

```php
    protected function getDepartmentSonIds($id)
    {
        static $ids=[];
        $parentIds=DepartmentModel::where('pid','eq',$id)->column('id');
        if ($parentIds==null){
            unset($parentIds);
        }else{
            foreach ($parentIds as $value){
                $ids[]=$value;
                $this->getDepartmentSonIds($value);
            }
        }
       return $ids;
    }
```

## **简化版2**

> thikphp版本

```php
 public static function getSonIds($parent_id){
        static $ids = [];
        if (empty($ids)) $ids[]=$parent_id; //如果需要保存最外层主键情况下  如果ids为空代表第一次查询
        $primary_ids = DepartmentModel::where('parent_id', $parent_id)->column('id');
        if (!empty($primary_ids)) {
            foreach ($primary_ids as $item) {
               $ids[]=$item;
               self::getSonIds($item);
            }
        }
        sort($ids);
        return $ids;
    }
```

## 多主键查询

```php
 public static function getSonIds($parent_id){
        static $ids = [];
        if (empty($ids)) $ids=array_merge($ids,$parent_id);//如果需要第一次添加实参
        //重庆分公司 == 373
        $primary_ids = OrgModel::whereIn('parent_id', $parent_id)->column('id');
        if (!empty($primary_ids)) {
            foreach ($primary_ids as $item) {
               self::getSonIds($item);
               $ids[]=$item;
            }
        }
        sort($ids);
        return $ids;
    }

# 调用

self::getSonIds([373,377]);// 可以携带出多个数据的儿子主键
```

